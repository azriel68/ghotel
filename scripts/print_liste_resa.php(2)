<?php

	  require("../includes/inc.php");
    require("../fpdf153/fpdf.php");
	  require("../includes/class.pdfmaker.php");

	  $db=new Tdb;
	  $r=new TRequete;
	  $TResa = $r->get_liste_reservation_du_jour($db, $_REQUEST['dt_jour']);

    $hotel = & $_SESSION[SESS_HOTEL];
    
    $Tableau['hotel']=array(
      "nom"=>$hotel->nom
      ,"adresse"=>$hotel->adresse
      ,"ville"=>$hotel->ville
      ,"cp"=>$hotel->cp
      ,"signature"=>$hotel->get_parameter("signature_doc")
      ,"commercial"=>$hotel->get_parameter("texte_commercial")
      ,"tel"=>$hotel->telephone
      ,"fax"=>$hotel->fax
    );



	  $p = new TPDFMaker;
	  
	  
	  
	  $pdf = new TPdf;
	  $pdf->AliasNbPages();
	    
	    //$db->db->debug=true;
	    
	  $nb=count($TResa);
	  for($i=0;$i<$nb;$i++){
	    $resa = new TReservation;
	    $resa->load($db, $TResa[$i], true, true, true);
	     
	    $trans["titre_categorie"] = $resa->chambre->categorie->libelle;
	    $trans["datedujour"] = date("d/m/Y");
	    $trans["reservation_date_debut"] = $resa->get_dtdeb();
	    $trans["reservation_date_fin"] = $resa->get_dtfin();
	    $trans["numero_chambre"] = $resa->chambre->num;
	    $trans["description_categorie"] = $resa->chambre->categorie->definition;
	    $trans["reservation_acompte"] = _fnumber($resa->acompte);
	    $trans["frais_de_reservation"]=0;
      $trans["ville"]=$hotel->ville;

    	$Tableau['client']=array(
        "nom"=>$resa->client->nom
        ,"adresse"=>$resa->client->adresse
      );
      
      

      
      $p->set_best_model_for($db, $resa->client->nationalite,"RESA") ;//DIR_MODEL."lettre_reservation.txt";
      
      $p->parse_file($Tableau);
	  
	    $p->write($pdf, $trans);  
	  }
	  

	  $pdf->Output("liste_reservations.pdf","I");




?>
