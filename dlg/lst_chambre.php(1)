<?

require("../includes/inc.php");

entete("Sélectionner la chambre");

$t=new TTbl;
$listname='dblist1';
$lst=new TListView($listname);

echo "<br />";
echo "<h1>Liste des chambres</h1>";
  
  $db=new Tdb;

  $form =new TForm(null, "formrecherche");

  $r=new TRequete;
  $TCat = $r->liste_toute_categorie($db, get_sess_hotel_id());

  echo $form->combo('','categorie', $TCat, 'auto' );
  echo $form->texte('', 'dt_deb', 'auto', 12, 10);
  echo $form->texte('', 'dt_fin', 'auto', 12, 10);

  echo $t->link("Trouver", "javascript:document.forms['formrecherche'].submit()", "button");

  echo $form->end_form();

  $db->close();

  $where="";
  if(isset($_REQUEST['categorie'])){
    $where.="AND a.id_categorie='".$_REQUEST['categorie']."' ";
    
    /*
    	A finir
    */
  }

//requête
$sql = "SELECT a.id as 'ID', a.num as 'Numéro', b.libelle as 'Catégorie', a.nb_lit as 'Nombre de lits'
, a.prestation as 'Prestation', a.orientation as 'Orientation', a.situation as 'Situation'
, a.prix as 'Prix', a.dt_cre as 'Création'
FROM hot_chambre a LEFT JOIN hot_categorie b ON (a.id_hotel=b.id_hotel AND a.id_categorie=b.id)
WHERE a.id_hotel=".get_sess_hotel_id()." ".$where;
$ordercolumn = isset($_REQUEST["orderColumn"])?$_REQUEST["orderColumn"]: 'Numéro';
$ordertype = isset($_REQUEST["orderTyp"])?$_REQUEST["orderTyp"]:"A";
$pagenumber = isset($_REQUEST["pageNumber"])?$_REQUEST["pageNumber"]:0;

$lst->Set_Query($sql);

$lst->Load_query($ordercolumn,$ordertype); // on charge la requête
$lst->Set_pagenumber($pagenumber);
$lst->set_key('ID',$_REQUEST['p0']);
$lst->set_key('Numéro',$_REQUEST['p1']);
$lst->set_key('Prix',$_REQUEST['p2']);
$lst->Set_columnType('Création','DATE');
$lst->Set_nbLinesPerPage(35);

if (!is_null($_REQUEST["FORM"]) && $_REQUEST["FORM"]>"")
    $lst->Set_onClickAction("LinkForm","'".$_REQUEST["FORM"]."'"); //on définie la fonction javascript appelée lors du click sur une ligne de la liste


echo $lst->Render();

pied_de_page();

?>